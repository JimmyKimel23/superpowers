# Эксперимент: Thin .mdc + Fat read_file (ticket-recon)

## Версия: 1.0 (закрыт)
## Дата: 2026-02-26
## Статус: ❌ Гипотеза отклонена

---

## Гипотеза

Тело workflow можно вынести из .mdc в отдельный файл. Thin .mdc (триггеры + инструкция read_file) остаётся в rules/, fat body читается через read_file при активации. Модель будет следовать инструкциям из read_file с тем же качеством, что и из системного промпта.

---

## Результаты

### Вариант A (baseline): full-body .mdc

Модель: GLM 4.6 Internal. Тикет: TAXIASSIST-593107.

Все шаги выполнены, MCP-параметры корректны, todo list создан, верификация пройдена.

### Вариант B (thin stub v1 — с кратким содержанием)

Модель: GLM 4.6 Internal (из лога Варианта A).

| Критерий | Результат |
|----------|-----------|
| Trigger | ✅ |
| read_file body вызван | ❌ |
| Шаг 0 (memory bank) | ❌ |
| Шаг 0.5 (тип участия) | ❌ |
| Шаг 1: GetIssue | ✅ (без параметров workflow) |
| Шаг 2: GetIssueLinks | ✅ |
| Шаг 3: GetIssue связанных | ⚠️ частично (взял 1 из 3) |
| Шаг 4: Сводка | ❌ нет структуры |
| Шаг 5: Верификация | ❌ |
| Todo list | ❌ |
| Параметры MCP | ❌ (defaults вместо workflow-specified) |

**Диагноз B:** Секция «Краткое содержание» дала модели достаточно контекста для импровизации. Модель увидела знакомый паттерн (тикет → MCP) и пошла по пути наименьшего сопротивления.

### Вариант B' (thin stub v2 — без краткого содержания)

Модель: Qwen 3 VL 235B. Тикет: TAXIASSIST-593107.

| Критерий | Результат |
|----------|-----------|
| Trigger | ✅ |
| read_file body вызван | ❌ |
| Шаг 0 (memory bank) | ❌ |
| Шаг 0.5 (тип участия) | ❌ |
| Шаг 1: GetIssue | ⚠️ да, с ошибкой (невалидный expand), retry |
| Шаг 2: GetIssueLinks | ❌ не вызван |
| Шаг 3: GetIssue связанных | ❌ |
| Шаг 4: Сводка | ❌ vanilla пересказ |
| Шаг 5: Верификация | ❌ |
| Todo list | ❌ |
| Параметры MCP | ⚠️ comments_limit=5 (должно 30), fields ограничены |

**Диагноз B':** Убирание краткого содержания не изменило поведение. Модель по-прежнему не вызвала read_file и импровизировала. Результат даже хуже B — не вызван GetIssueLinks.

---

## Анализ корневой причины

**Домен проблемы: Platform engineering (flow control).**

Модель в .mdc-контексте не выполняет read_file как обязательный первый шаг. Это согласуется с установленным принципом (Наблюдения 4, 7, 8): custom instructions контролируют содержание (что делать), но не поток (когда и в каком порядке использовать инструменты).

.mdc → системный промпт → модель видит инструкцию «вызови read_file» → классифицирует запрос → выбирает инструмент по собственной логике (MCP, а не read_file) → игнорирует инструкцию.

Это тот же механизм, что в Наблюдении 7 (alwaysApply ≠ исполнение) и Наблюдении 8 (модель выбирает встроенный инструмент вместо кастомного). Разница: там инструкция была «используй tracking file вместо todo list», здесь — «используй read_file перед MCP». Оба — попытки контролировать поток через промпт.

**Дополнительный фактор:** Тестировались две разные модели (GLM 4.6, Qwen 3 VL 235B) — обе проигнорировали read_file. Это подтверждает, что проблема не model-specific, а platform-level.

---

## Выводы

1. **Thin stub + read_file не работает** как паттерн на Yandex Code Assistant. Модели не выполняют read_file из .mdc как обязательный первый шаг.

2. **Workflow body должен быть в .mdc.** Содержание, которое должно исполняться — должно быть в системном промпте (т.е. в .mdc), а не в файле, который модель должна сама решить прочитать.

3. **Краткое содержание в stub — вредно, но его отсутствие не помогает.** B' показал, что даже без краткого содержания модель не обращается к read_file. Она просто импровизирует с ещё меньшим контекстом.

4. **Подтверждён принцип:** content control (что агент видит) ≠ flow control (что агент делает первым). read_file в .mdc — это flow control, который не работает через custom instructions.

---

## Решение

Rollback к full-body `workflow-ticket-recon.mdc`. Паттерн thin stub + read_file не масштабируется.

Для решения проблемы context debt (исходная мотивация эксперимента) — искать другие подходы: hot/cold разделение memory bank, compression cycles, lean-версии workflow.