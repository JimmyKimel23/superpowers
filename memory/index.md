# Memory Bank — Навигационная карта

> Точка входа для любой комплаенс-задачи. Определи, что тебе нужно, и перейди к нужному разделу.

## Быстрый маршрут по типу задачи

| Тип задачи | Куда идти первым | Затем |
|---|---|---|
| Новая комплаенс-задача (donations, G&H, DD) | `patterns.md` → есть ли отработанный подход? | `.codeassistant/rules/workflow-*.mdc` → есть ли workflow? |
| Повторяющаяся задача | `lessons-learned.md` → чему научились в прошлый раз? | `patterns.md` → какой подход сработал? |
| Незнакомый термин или процесс | `definitions.md` | `knowledge-base/policies/` → если нужна политика |
| Анализ документов (review) | `patterns.md` → паттерн анализа | `lessons-learned.md` → типичные ошибки |
| Создание нового workflow | `patterns.md` → существующие паттерны | Существующие `workflow-*.mdc` как референс |
| Обнаружена ошибка модели | `patterns.md` → секция "Рационализации агента" | `lessons-learned.md` → зафиксировать |

> **Примечание:** Все основные workflows содержат обязательный **Шаг 0 (Подготовка)**, который автоматически направляет агента к memory bank перед началом работы. Шаг 0 включает: чтение index.md, проверку lessons-learned.md и patterns.md, идентификацию входных документов.

## Структура Memory Bank

### Память (`.codeassistant/memory/`)

| Файл | Содержание | Когда читать | Когда обновлять |
|---|---|---|---|
| **`index.md`** (этот файл) | Навигация, маршруты, структура | Начало любой задачи | При добавлении новых файлов |
| **`lessons-learned.md`** | Ошибки, выводы, решения из прошлых задач | Перед задачей того же типа | После обнаружения ошибки или неочевидного вывода |
| **`definitions.md`** | Термины ABC, внутренние определения, пороги | При работе с терминами, при уточнении процессов | При уточнении термина или обнаружении нового |
| **`patterns.md`** | Рабочие паттерны + рационализации агента | Перед выполнением задачи | После обнаружения рабочего подхода или обхода инструкций |

### Правила и workflow (`.codeassistant/rules/`)

| Файл | Назначение | Триггер |
|---|---|---|
| `rule-memory-bank-usage.mdc` | Порядок работы с memory bank | alwaysApply |
| `rule-single-stage-execution.mdc` | Выполнение одного этапа плана | По запросу — когда нужно выполнить конкретный этап |
| `rule-all-stages-execution.mdc` | Выполнение всех этапов с tracking | По запросу — когда нужно выполнить весь план |
| `workflow-doc-coauthoring.mdc` | Совместное создание комплаенс-документов (Шаг 0 ✅) | Триггеры: ("написать", "создать", "подготовить") И (комплаенс-документ, политик*, процедур*, инструкц*, due diligence, отчёт*, ABC-оговорк*, памятк*) |
| `workflow-ticket-recon.mdc` | Разведка тикета / Ticket Reconnaissance (Шаг 0 ✅) | Триггеры: тикет, ticket, трекер, tracker, "изучи задач*", "собери контекст", "разведка тикет*", reconnaissance, "посмотри задач*", "что в тикет*" |
| `workflow-donations.md` | Проверка благотворительных пожертвований (Шаг 0 ✅) | Триггеры: благотворительн*, пожертвовани*, donation* |
| `workflow-gifts-hospitality.mdc` | Gifts & Hospitality v2.0 (Шаг 0 ✅) | Триггеры: *подар* или *знак делового гостеприимства* или *11 000 ₽* или *госслужащие* или *PEP* или *комплект* или *массовая передача* |
| `workflow-dd.mdc` | Due Diligence контрагентов | *(планируется)* |
| `workflow-sponsorship.mdc` | Анализ спонсорства (Шаг 0 ✅) | Триггеры: спонсорств*, "спонсорский договор", "спонсорская поддержка", "встречные услуги в спонсорстве" |
| `workflow-ako-validation.md` | Антикоррупционные оговорки (Шаг 0 ✅) | АКО*, ACC*, Опросник*, *Questionnaire* |
| `workflow-development.mdc` | Мета-workflow: R&D-процесс создания новых workflow (WDL) (Шаг 0 ✅) | Триггеры: "создай workflow", "спроектируй workflow", "WDL-цикл", "R&D-процесс для workflow" |


### Справочные материалы (`knowledge-base/`)

| Директория | Содержание | Приоритет |
|---|---|---|
| `knowledge-base/policies/` | Внутренние политики компании | **Наивысший** — источник правды для требований |
| `knowledge-base/regulations/` | Нормативные акты, законы, стандарты | Средний |
| `knowledge-base/agreements/` | Шаблоны соглашений | Справочный |

### Рабочие файлы (`workflows/`)

| Директория | Содержание |
|---|---|
| `workflows/templates/` | Шаблоны выходных документов: scenario-bank-template.md, deployment-checklist.md |
| `workflows/active/`    | Текущие задачи в работе, файлы результатов |
| `workflows/scenarios/` | Заполненные scenario banks для каждого workflow |

## Приоритет источников (при противоречиях)

```
1. Внутренние политики (knowledge-base/policies/)     ← источник правды
2. Memory bank (lessons-learned, patterns, definitions) ← целевой дизайн
3. Документы текущей задачи                            ← конкретные данные
4. Нормативные акты (knowledge-base/regulations/)      ← внешние требования
5. Общие знания модели                                 ← только если нет выше
```

При использовании общих знаний — маркируй явно: "На основе общих знаний, не подтверждено внутренней политикой."

## Как обновлять этот файл

- При добавлении нового файла в memory bank — добавь строку в соответствующую таблицу
- При создании нового workflow — добавь в таблицу правил
- При изменении приоритетов или маршрутов — обнови таблицу быстрого маршрута
- Не удаляй строки о запланированных, но не созданных файлах — они служат roadmap
